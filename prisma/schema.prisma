// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// Product models
model Product {
  id               String            @id @default(cuid())
  handle           String            @unique
  title            String
  description      String            @default("")
  descriptionHtml  String            @default("")
  availableForSale Boolean           @default(true)
  tags             String[]          @default([])
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  
  featuredImageId  String?
  featuredImage    Image?            @relation("ProductFeaturedImage", fields: [featuredImageId], references: [id])
  
  images           Image[]           @relation("ProductImages")
  variants         ProductVariant[]
  options          ProductOption[]
  priceRange       ProductPriceRange?
  seo              ProductSEO?
  cartItems        CartItem[]
  collectionProducts CollectionProduct[]
  
  @@index([handle])
}

model ProductVariant {
  id                String   @id @default(cuid())
  title             String
  availableForSale  Boolean  @default(true)
  priceAmount       String
  priceCurrency     String   @default("USD")
  
  productId         String
  product           Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  selectedOptions   VariantOption[]
  cartItems         CartItem[]
  
  @@index([productId])
}

model VariantOption {
  id        String         @id @default(cuid())
  name      String
  value     String
  
  variantId String
  variant   ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)
  
  @@index([variantId])
}

model ProductOption {
  id        String   @id @default(cuid())
  name      String
  values    String[]
  
  productId String
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  @@index([productId])
}

model ProductPriceRange {
  id                      String  @id @default(cuid())
  maxVariantPriceAmount   String
  maxVariantPriceCurrency String  @default("USD")
  minVariantPriceAmount   String
  minVariantPriceCurrency String  @default("USD")
  
  productId               String  @unique
  product                 Product @relation(fields: [productId], references: [id], onDelete: Cascade)
}

model ProductSEO {
  id          String  @id @default(cuid())
  title       String
  description String
  
  productId   String  @unique
  product     Product @relation(fields: [productId], references: [id], onDelete: Cascade)
}

model Image {
  id       String @id @default(cuid())
  url      String
  altText  String
  width    Int
  height   Int
  
  productId String?
  product   Product? @relation("ProductImages", fields: [productId], references: [id], onDelete: Cascade)
  
  featuredForProduct Product[] @relation("ProductFeaturedImage")
  
  @@index([productId])
}

// Collection models
model Collection {
  id          String      @id @default(cuid())
  handle      String      @unique
  title       String
  description String      @default("")
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  
  seo         CollectionSEO?
  products    CollectionProduct[]
  
  @@index([handle])
}

model CollectionProduct {
  id           String     @id @default(cuid())
  
  collectionId String
  collection   Collection @relation(fields: [collectionId], references: [id], onDelete: Cascade)
  
  productId    String
  product      Product    @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  position     Int        @default(0)
  
  @@unique([collectionId, productId])
  @@index([collectionId])
  @@index([productId])
}

model CollectionSEO {
  id           String     @id @default(cuid())
  title        String
  description  String
  
  collectionId String     @unique
  collection   Collection @relation(fields: [collectionId], references: [id], onDelete: Cascade)
}

// Cart models
model Cart {
  id                      String     @id @default(cuid())
  checkoutUrl             String     @default("")
  
  subtotalAmount          String     @default("0.0")
  subtotalCurrency        String     @default("USD")
  totalAmount             String     @default("0.0")
  totalCurrency           String     @default("USD")
  totalTaxAmount          String     @default("0.0")
  totalTaxCurrency        String     @default("USD")
  
  totalQuantity           Int        @default(0)
  
  createdAt               DateTime   @default(now())
  updatedAt               DateTime   @updatedAt
  
  lines                   CartItem[]
}

model CartItem {
  id                String         @id @default(cuid())
  quantity          Int            @default(1)
  
  totalAmount       String
  totalCurrency     String         @default("USD")
  
  cartId            String
  cart              Cart           @relation(fields: [cartId], references: [id], onDelete: Cascade)
  
  merchandiseId     String
  merchandise       ProductVariant @relation(fields: [merchandiseId], references: [id])
  
  productId         String
  product           Product        @relation(fields: [productId], references: [id])
  
  @@index([cartId])
  @@index([merchandiseId])
}

// Menu models
model Menu {
  id     String     @id @default(cuid())
  handle String     @unique
  items  MenuItem[]
  
  @@index([handle])
}

model MenuItem {
  id     String @id @default(cuid())
  title  String
  url    String
  
  menuId String
  menu   Menu   @relation(fields: [menuId], references: [id], onDelete: Cascade)
  
  @@index([menuId])
}

// Page models
model Page {
  id          String   @id @default(cuid())
  handle      String   @unique
  title       String
  body        String   @default("")
  bodySummary String   @default("")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  seo         PageSEO?
  
  @@index([handle])
}

model PageSEO {
  id          String @id @default(cuid())
  title       String
  description String
  
  pageId      String @unique
  page        Page   @relation(fields: [pageId], references: [id], onDelete: Cascade)
}
