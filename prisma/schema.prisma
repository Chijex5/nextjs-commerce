// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// Products table - stores the main product information
model Product {
  id               String   @id @default(uuid())
  handle           String   @unique @db.VarChar(255)
  title            String   @db.VarChar(255)
  description      String?  @db.Text
  descriptionHtml  String?  @map("description_html") @db.Text
  availableForSale Boolean  @default(true) @map("available_for_sale")
  seoTitle         String?  @map("seo_title") @db.VarChar(255)
  seoDescription   String?  @map("seo_description") @db.Text
  tags             String[] @default([])
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @default(now()) @updatedAt @map("updated_at")

  variants           ProductVariant[]
  images             ProductImage[]
  options            ProductOption[]
  productCollections ProductCollection[]

  @@index([handle], name: "products_handle_idx")
  @@index([tags], name: "products_tags_idx")
  @@map("products")
}

// Product variants - stores size, color, and other variant options
model ProductVariant {
  id               String   @id @default(uuid())
  productId        String   @map("product_id")
  title            String   @db.VarChar(255)
  price            Decimal  @db.Decimal(10, 2)
  currencyCode     String   @default("NGN") @map("currency_code") @db.VarChar(3)
  availableForSale Boolean  @default(true) @map("available_for_sale")
  selectedOptions  Json     @default("[]") @map("selected_options")
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @default(now()) @updatedAt @map("updated_at")

  product   Product    @relation(fields: [productId], references: [id], onDelete: Cascade)
  cartLines CartLine[]

  @@index([productId], name: "product_variants_product_id_idx")
  @@map("product_variants")
}

// Product options - stores available options like "Size", "Color"
model ProductOption {
  id        String   @id @default(uuid())
  productId String   @map("product_id")
  name      String   @db.VarChar(100)
  values    String[]
  createdAt DateTime @default(now()) @map("created_at")

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("product_options")
}

// Product images
model ProductImage {
  id         String   @id @default(uuid())
  productId  String   @map("product_id")
  url        String   @db.Text
  altText    String?  @map("alt_text") @db.VarChar(255)
  width      Int?
  height     Int?
  position   Int      @default(0)
  isFeatured Boolean  @default(false) @map("is_featured")
  createdAt  DateTime @default(now()) @map("created_at")

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId], name: "product_images_product_id_idx")
  @@index([position], name: "product_images_position_idx")
  @@map("product_images")
}

// Collections (categories)
model Collection {
  id             String   @id @default(uuid())
  handle         String   @unique @db.VarChar(255)
  title          String   @db.VarChar(255)
  description    String?  @db.Text
  seoTitle       String?  @map("seo_title") @db.VarChar(255)
  seoDescription String?  @map("seo_description") @db.Text
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @default(now()) @updatedAt @map("updated_at")

  productCollections ProductCollection[]

  @@index([handle], name: "collections_handle_idx")
  @@map("collections")
}

// Many-to-many relationship between products and collections
model ProductCollection {
  id           String   @id @default(uuid())
  productId    String   @map("product_id")
  collectionId String   @map("collection_id")
  position     Int      @default(0)
  createdAt    DateTime @default(now()) @map("created_at")

  product    Product    @relation(fields: [productId], references: [id], onDelete: Cascade)
  collection Collection @relation(fields: [collectionId], references: [id], onDelete: Cascade)

  @@index([productId], name: "product_collections_product_id_idx")
  @@index([collectionId], name: "product_collections_collection_id_idx")
  @@map("product_collections")
}

// Carts table
model Cart {
  id             String   @id @default(uuid())
  checkoutUrl    String?  @map("checkout_url") @db.Text
  totalQuantity  Int      @default(0) @map("total_quantity")
  subtotalAmount Decimal  @default(0.00) @map("subtotal_amount") @db.Decimal(10, 2)
  totalAmount    Decimal  @default(0.00) @map("total_amount") @db.Decimal(10, 2)
  totalTaxAmount Decimal  @default(0.00) @map("total_tax_amount") @db.Decimal(10, 2)
  currencyCode   String   @default("NGN") @map("currency_code") @db.VarChar(3)
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @default(now()) @updatedAt @map("updated_at")

  lines CartLine[]

  @@map("carts")
}

// Cart lines (items in cart)
model CartLine {
  id               String   @id @default(uuid())
  cartId           String   @map("cart_id")
  productVariantId String   @map("product_variant_id")
  quantity         Int      @default(1)
  totalAmount      Decimal  @default(0.00) @map("total_amount") @db.Decimal(10, 2)
  currencyCode     String   @default("NGN") @map("currency_code") @db.VarChar(3)
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @default(now()) @updatedAt @map("updated_at")

  cart    Cart           @relation(fields: [cartId], references: [id], onDelete: Cascade)
  variant ProductVariant @relation(fields: [productVariantId], references: [id])

  @@index([cartId], name: "cart_lines_cart_id_idx")
  @@index([productVariantId], name: "cart_lines_variant_id_idx")
  @@map("cart_lines")
}

// Pages table for static content
model Page {
  id             String   @id @default(uuid())
  handle         String   @unique @db.VarChar(255)
  title          String   @db.VarChar(255)
  body           String?  @db.Text
  bodySummary    String?  @map("body_summary") @db.Text
  seoTitle       String?  @map("seo_title") @db.VarChar(255)
  seoDescription String?  @map("seo_description") @db.Text
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @default(now()) @updatedAt @map("updated_at")

  @@index([handle], name: "pages_handle_idx")
  @@map("pages")
}

// Menus for navigation
model Menu {
  id        String   @id @default(uuid())
  handle    String   @unique @db.VarChar(255)
  title     String   @db.VarChar(255)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  items MenuItem[]

  @@map("menus")
}

// Menu items
model MenuItem {
  id        String   @id @default(uuid())
  menuId    String   @map("menu_id")
  title     String   @db.VarChar(255)
  url       String   @db.Text
  position  Int      @default(0)
  createdAt DateTime @default(now()) @map("created_at")

  menu Menu @relation(fields: [menuId], references: [id], onDelete: Cascade)

  @@index([menuId], name: "menu_items_menu_id_idx")
  @@index([position], name: "menu_items_position_idx")
  @@map("menu_items")
}

// Admin users for dashboard access
model AdminUser {
  id           String    @id @default(uuid())
  email        String    @unique @db.VarChar(255)
  name         String?   @db.VarChar(255)
  passwordHash String    @map("password_hash") @db.Text
  role         String    @default("admin") @db.VarChar(50)
  isActive     Boolean   @default(true) @map("is_active")
  lastLoginAt  DateTime? @map("last_login_at")
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @default(now()) @updatedAt @map("updated_at")

  @@index([email], name: "admin_users_email_idx")
  @@map("admin_users")
}

// Customer users for shopping
model User {
  id              String    @id @default(uuid())
  email           String    @unique @db.VarChar(255)
  name            String?   @db.VarChar(255)
  passwordHash    String    @map("password_hash") @db.Text
  phone           String?   @db.VarChar(50)
  shippingAddress Json?     @map("shipping_address")
  billingAddress  Json?     @map("billing_address")
  isActive        Boolean   @default(true) @map("is_active")
  lastLoginAt     DateTime? @map("last_login_at")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @default(now()) @updatedAt @map("updated_at")

  orders Order[]

  @@index([email], name: "users_email_idx")
  @@map("users")
}

// Orders for tracking purchases
model Order {
  id                  String    @id @default(uuid())
  userId              String?   @map("user_id")
  orderNumber         String    @unique @db.VarChar(50)
  email               String    @db.VarChar(255)
  phone               String?   @db.VarChar(50)
  customerName        String    @map("customer_name") @db.VarChar(255)
  shippingAddress     Json      @map("shipping_address")
  billingAddress      Json?     @map("billing_address")
  status              String    @default("pending") @db.VarChar(50)
  // Delivery tracking fields
  deliveryStatus      String    @default("production") @map("delivery_status") @db.VarChar(50)
  estimatedArrival    DateTime? @map("estimated_arrival")
  // Financial fields
  subtotalAmount      Decimal   @map("subtotal_amount") @db.Decimal(10, 2)
  taxAmount           Decimal   @default(0.00) @map("tax_amount") @db.Decimal(10, 2)
  shippingAmount      Decimal   @default(0.00) @map("shipping_amount") @db.Decimal(10, 2)
  totalAmount         Decimal   @map("total_amount") @db.Decimal(10, 2)
  currencyCode        String    @default("NGN") @map("currency_code") @db.VarChar(3)
  notes               String?   @db.Text
  trackingNumber      String?   @map("tracking_number") @db.VarChar(100)
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @default(now()) @updatedAt @map("updated_at")

  user  User?       @relation(fields: [userId], references: [id])
  items OrderItem[]

  @@index([orderNumber], name: "orders_order_number_idx")
  @@index([userId], name: "orders_user_id_idx")
  @@index([email], name: "orders_email_idx")
  @@index([status], name: "orders_status_idx")
  @@index([deliveryStatus], name: "orders_delivery_status_idx")
  @@map("orders")
}

// Order items
model OrderItem {
  id               String   @id @default(uuid())
  orderId          String   @map("order_id")
  productId        String   @map("product_id")
  productVariantId String   @map("product_variant_id")
  productTitle     String   @map("product_title") @db.VarChar(255)
  variantTitle     String   @map("variant_title") @db.VarChar(255)
  quantity         Int
  price            Decimal  @db.Decimal(10, 2)
  totalAmount      Decimal  @map("total_amount") @db.Decimal(10, 2)
  currencyCode     String   @default("NGN") @map("currency_code") @db.VarChar(3)
  productImage     String?  @map("product_image") @db.Text
  createdAt        DateTime @default(now()) @map("created_at")

  order Order @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId], name: "order_items_order_id_idx")
  @@map("order_items")
}
